<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>対局順決定ツール（リアルタイム同期版）</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
  body { font-family: sans-serif; text-align: center; padding: 20px; }
  h2 { margin-bottom: 10px; }
  select, button, input { font-size: 18px; padding: 8px; margin: 6px; }
  .name-box { margin: 5px auto; width: 80%; max-width: 300px; }
  .name-box input { width: 100%; padding: 8px; font-size: 16px; }
  #result-area { margin-top: 20px; font-size: 20px; }
  .result-item { padding: 10px; margin: 6px auto; width: 80%; max-width: 300px;
    border: 1px solid #ccc; border-radius: 6px; background: #f9f9f9; }
  #host-only { border: 2px solid #f00; padding: 10px; margin: 10px; }
</style>
</head>

<body>

<h2>対局順決定ツール（リアルタイム同期版）</h2>

<!-- ホスト用 -->
<div id="host-only">
  <h3>ホスト（fumito）専用</h3>
  <button onclick="makeRoom()">部屋を作る</button>
  <p>部屋ID: <span id="my-id">---</span></p>

  <label>参加人数:
    <select id="count" onchange="hostChangeCount()">
      <option value="3">3人</option>
      <option value="4">4人</option>
      <option value="5" selected>5人</option>
      <option value="6">6人</option>
    </select>
  </label>

  <button onclick="hostDecide()">OK（結果決定）</button>
</div>

<hr>

<!-- 参加者用 -->
<h3>参加者</h3>
<p>部屋IDを入力して参加</p>
<input id="join-id" placeholder="部屋ID">
<button onclick="joinRoom()">参加</button>

<p>自分の番号を選ぶ</p>
<select id="my-index" onchange="claimIndex()">
  <option value="">未選択</option>
  <option value="0">1番</option>
  <option value="1">2番</option>
  <option value="2">3番</option>
  <option value="3">4番</option>
  <option value="4">5番</option>
  <option value="5">6番</option>
</select>

<hr>

<div id="inputs"></div>

<h3>結果</h3>
<div id="result-area"></div>

<script>
let peer;
let connections = [];
let isHost = false;
let myIndex = null;
let claimed = {}; // { index: peerId }

// ----------------------
// UI生成
// ----------------------
function renderInputs(count = 5) {
  const area = document.getElementById("inputs");
  area.innerHTML = "";
  for (let i = 0; i < count; i++) {
    area.innerHTML += `
      <div class="name-box">
        <input id="name${i}" placeholder="名前 ${i+1}" disabled
          oninput="sendName(${i})">
      </div>
    `;
  }
}

// ----------------------
// ホストが部屋を作る
// ----------------------
function makeRoom() {
  isHost = true;
  peer = new Peer();

  peer.on("open", id => {
    document.getElementById("my-id").textContent = id;
  });

  peer.on("connection", conn => {
    connections.push(conn);
    conn.on("data", data => handleData(conn, data));
  });
}

// ----------------------
// 参加者が部屋に入る
// ----------------------
function joinRoom() {
  const hostId = document.getElementById("
